<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TRAILS - Snake Chain</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior: none;
        }

        .no-select { user-select: none; }
        
        /* Premium transitions */
        .theme-transition { transition: background-color 0.4s cubic-bezier(0.4, 0, 0.2, 1), color 0.4s ease; }
        
        /* Subtle tile "pop" animation */
        .tile-active { transform: scale(1.05); z-index: 30; }

        /* Hide scrollbars for the clean look */
        ::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="theme-transition">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- WORLD CLASS GRID CONFIG ---
        const GRID_WIDTH = 8;
        const CHECK_PENALTY = 15;
        const CELL_SIZE = 38; 
        const GAP_X = 5;      
        const GAP_Y = 36;     

        const DAILY_CONFIG = {
            // P-O-C-K-E-[T]-I-C-K-E-[T]-R-A-V-E-[L]-O-N-D-O-N
            solution: "POCKETICKETRAVELONDON",
            words: [
                { category: "STORAGE" },
                { category: "ADMISSION" },
                { category: "JOURNEY" },
                { category: "CITY" }
            ],
            hingeIndices: [5, 10, 15], 
            anchors: [0, 20] 
        };

        const SOLUTION_STR = DAILY_CONFIG.solution;

        // --- DESIGNER ASSETS (SVGs) ---
        const SunIcon = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"/></svg>;
        const MoonIcon = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>;
        const TimerIcon = () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#F97316" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>;
        const EyeIcon = () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0z"/><circle cx="12" cy="12" r="3"/></svg>;
        const LockIcon = () => <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="white" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>;
        const TrophyIcon = () => <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>;

        const App = () => {
            const [grid, setGrid] = useState([]);
            const [bank, setBank] = useState([]);
            const [selectedBankIdx, setSelectedBankIdx] = useState(null);
            const [isGameOver, setIsGameOver] = useState(false);
            const [showShareModal, setShowShareModal] = useState(false);
            const [personalMessage, setPersonalMessage] = useState("");
            const [selectedEmoji, setSelectedEmoji] = useState("ðŸ‘‹");
            const [showValidation, setShowValidation] = useState(false);
            const [darkMode, setDarkMode] = useState(true);
            
            const [seconds, setSeconds] = useState(0);
            const [isActive, setIsActive] = useState(false);
            const [checkCount, setCheckCount] = useState(0);
            const timerRef = useRef(null);

            // --- PATH LOGIC: PIXEL PERFECT SNAKE ---
            const pathNodes = useMemo(() => {
                let nodes = [];
                let r = 0, c = 0, dir = 1; 
                for (let i = 0; i < SOLUTION_STR.length; i++) {
                    nodes.push({ r, c, index: i });
                    if (dir === 1) {
                        if (c < GRID_WIDTH - 1) c++;
                        else { r++; dir = -1; }
                    } else {
                        if (c > 0) c--;
                        else { r++; dir = 1; }
                    }
                }
                return nodes;
            }, []);

            const svgPathD = useMemo(() => {
                return pathNodes.reduce((acc, node, i) => {
                    const x = node.c * (CELL_SIZE + GAP_X) + CELL_SIZE / 2;
                    const y = node.r * (CELL_SIZE + GAP_Y) + CELL_SIZE / 2;
                    return acc + (i === 0 ? `M ${x} ${y}` : ` L ${x} ${y}`);
                }, "");
            }, [pathNodes]);

            // --- TIMER ---
            useEffect(() => {
                if (isActive && !isGameOver) {
                    timerRef.current = setInterval(() => setSeconds(s => s + 1), 1000);
                } else {
                    clearInterval(timerRef.current);
                }
                return () => clearInterval(timerRef.current);
            }, [isActive, isGameOver]);

            const formatTime = (t) => {
                const m = Math.floor(t / 60);
                const s = t % 60;
                return `${m}:${s.toString().padStart(2, '0')}`;
            };

            // --- DATA INIT ---
            useEffect(() => {
                const initialGrid = SOLUTION_STR.split("").map((char, i) => {
                    if (DAILY_CONFIG.anchors.includes(i)) return char;
                    return null;
                });
                setGrid(initialGrid);

                const interiorLetters = SOLUTION_STR.split("").filter((_, i) => !DAILY_CONFIG.anchors.includes(i));
                setBank(interiorLetters.sort(() => Math.random() - 0.5).map((char, id) => ({ char, id, used: false })));
            }, []);

            // --- HANDLERS ---
            const handleBankClick = (idx) => {
                if (isGameOver || bank[idx].used) return;
                setSelectedBankIdx(idx === selectedBankIdx ? null : idx);
            };

            const handleGridClick = (idx) => {
                if (isGameOver || DAILY_CONFIG.anchors.includes(idx)) return;
                if (!isActive) setIsActive(true);

                const newGrid = [...grid];
                const newBank = [...bank];

                if (selectedBankIdx !== null && newGrid[idx] === null) {
                    newGrid[idx] = newBank[selectedBankIdx].char;
                    newBank[selectedBankIdx].used = true;
                    setGrid(newGrid);
                    setBank(newBank);
                    setSelectedBankIdx(null);
                    setShowValidation(false); 
                } else if (newGrid[idx] !== null) {
                    const charToRemove = newGrid[idx];
                    const bankItem = newBank.find(b => b.char === charToRemove && b.used);
                    if (bankItem) bankItem.used = false;
                    newGrid[idx] = null;
                    setGrid(newGrid);
                    setBank(newBank);
                    setShowValidation(false);
                }
            };

            const handleCheck = () => {
                if (isGameOver) return;
                setCheckCount(c => c + 1);
                setSeconds(s => s + CHECK_PENALTY);
                setShowValidation(true);
            };

            const isComplete = grid.every(char => char !== null);
            const score = grid.filter((char, i) => char === SOLUTION_STR[i]).length;

            const copyToClipboard = () => {
                const visual = grid.map((char, i) => {
                    if (DAILY_CONFIG.anchors.includes(i)) return "ðŸŸ¦";
                    return char === SOLUTION_STR[i] ? "ðŸŸ©" : "â¬œ";
                }).join("");

                const text = `You have mail ðŸ“©\n${selectedEmoji} ${personalMessage}\n\nâ± Time: ${formatTime(seconds)}\nðŸ” Checks: ${checkCount}\nâœ… Accuracy: ${score}/21\n\n${visual}\n\nPlay TRAILS at planomy.github.io/trails`;
                
                const el = document.createElement('textarea');
                el.value = text;
                document.body.appendChild(el);
                el.select();
                document.execCommand('copy');
                document.body.removeChild(el);

                const btn = document.getElementById('share-btn');
                if (btn) btn.innerText = "COPIED TO CLIPBOARD!";
                setTimeout(() => { if (btn) btn.innerText = "SHARE YOUR RESULTS"; }, 2000);
            };

            return (
                <div className={`min-h-screen theme-transition p-4 pb-8 flex flex-col items-center select-none no-select overflow-x-hidden ${darkMode ? 'bg-[#020617] text-slate-200' : 'bg-[#F8FAFC] text-slate-800'}`}>
                    
                    {/* Header: Pro Layout */}
                    <header className="w-full max-w-[340px] flex justify-between items-center mb-8 mt-4">
                        <h1 className="text-4xl font-black tracking-tighter text-orange-500 italic leading-none filter drop-shadow-sm">TRAILS</h1>
                        <div className="flex items-center gap-2">
                            <button onClick={() => setDarkMode(!darkMode)} className={`p-2.5 rounded-2xl border-2 transition-all active:scale-90 ${darkMode ? 'border-slate-800 bg-slate-900 text-orange-400' : 'border-slate-200 bg-white text-slate-400'}`}>
                                {darkMode ? <SunIcon /> : <MoonIcon />}
                            </button>
                            <div className={`${darkMode ? 'bg-slate-900 border-slate-800' : 'bg-white border-slate-200'} px-3 py-2 rounded-2xl shadow-sm border-2 flex items-center gap-2 min-w-[95px] justify-center`}>
                                <TimerIcon />
                                <div className={`text-xl font-black font-mono tracking-tighter ${darkMode ? 'text-orange-400' : 'text-slate-700'}`}>
                                    {formatTime(seconds)}
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* Word Category Pills: Condensed */}
                    <div className={`w-full max-w-[340px] p-3 rounded-2xl shadow-sm border mb-12 transition-colors ${darkMode ? 'bg-slate-900/50 border-slate-800' : 'bg-white border-slate-200'}`}>
                        <div className="flex flex-wrap gap-1.5 justify-center">
                            {DAILY_CONFIG.words.map((w, i) => (
                                <span key={i} className={`px-3 py-1 rounded-lg text-[10px] font-bold border uppercase italic tracking-wider transition-colors ${darkMode ? 'bg-slate-800 text-slate-400 border-slate-700' : 'bg-slate-50 text-slate-500 border-slate-100'}`}>
                                    {w.category}
                                </span>
                            ))}
                        </div>
                    </div>

                    {/* THE GRID: PIXEL-PERFECT CENTERED PATH */}
                    <div 
                        className="relative mb-14"
                        style={{ 
                            width: GRID_WIDTH * CELL_SIZE + (GRID_WIDTH - 1) * GAP_X,
                            height: 3 * CELL_SIZE + 2 * GAP_Y 
                        }}
                    >
                        {/* THE SOLID ORANGE PATH LINE */}
                        <svg className="absolute inset-0 z-0 pointer-events-none overflow-visible">
                            <path 
                                d={svgPathD}
                                fill="transparent" 
                                stroke="#F97316" 
                                strokeWidth="6" 
                                strokeLinecap="round" 
                                strokeLinejoin="round"
                                className={darkMode ? "opacity-90" : "opacity-40"}
                            />
                        </svg>

                        {/* TILE GRID LAYER */}
                        <div className="relative z-10 flex flex-col" style={{ gap: GAP_Y }}>
                            {[0, 1, 2].map(rIdx => (
                                <div key={rIdx} className="flex" style={{ gap: GAP_X }}>
                                    {Array.from({ length: 8 }).map((_, cIdx) => {
                                        const node = pathNodes.find(n => n.r === rIdx && n.c === cIdx);
                                        if (!node) return <div key={cIdx} style={{ width: CELL_SIZE, height: CELL_SIZE }} />;

                                        const idx = node.index;
                                        const char = grid[idx];
                                        const isAnchor = DAILY_CONFIG.anchors.includes(idx);
                                        const isHinge = DAILY_CONFIG.hingeIndices.includes(idx);
                                        const isCorrect = char === SOLUTION_STR[idx];

                                        return (
                                            <button
                                                key={cIdx}
                                                onClick={() => handleGridClick(idx)}
                                                style={{ width: CELL_SIZE, height: CELL_SIZE }}
                                                className={`
                                                    flex items-center justify-center text-xl font-black rounded-[12px]
                                                    transition-all duration-300 transform relative active:scale-90
                                                    ${isAnchor ? 'bg-blue-600 text-white shadow-lg' : 
                                                        (showValidation || isGameOver) && isCorrect ? 'bg-emerald-600 text-white scale-105 ring-4 ring-emerald-500/20' :
                                                        (showValidation || isGameOver) && !isCorrect && char ? 'bg-rose-500 text-white' :
                                                        char ? (darkMode ? 'bg-slate-800 text-indigo-300 border-2 border-slate-700 shadow-xl' : 'bg-white border-2 border-indigo-200 text-indigo-700 shadow-md') :
                                                        (darkMode ? 'bg-slate-900 border-2 border-slate-800/50 text-slate-700' : 'bg-white border-2 border-slate-100 text-slate-200')}
                                                    ${isHinge ? (darkMode ? 'ring-[3.5px] ring-white z-20' : 'ring-[3.5px] ring-slate-800 z-20') : ''}
                                                `}
                                            >
                                                {char}
                                                {isAnchor && <div className="absolute top-0.5 left-0.5"><LockIcon /></div>}
                                            </button>
                                        );
                                    })}
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* ACTION AREA */}
                    <div className="mb-12">
                        <button 
                            onClick={handleCheck}
                            className={`flex items-center gap-2 text-[11px] font-bold uppercase tracking-[0.2em] transition-all py-3 px-10 rounded-full border shadow-sm active:scale-95 ${darkMode ? 'bg-slate-900 text-slate-400 border-slate-800 hover:text-orange-400' : 'bg-white text-slate-500 border-slate-200 hover:text-indigo-600'}`}
                        >
                            <EyeIcon /> CHECK TRAIL <span className="opacity-50 ml-1">(+15s)</span>
                        </button>
                    </div>

                    {/* INDIGO LETTER TRAY: ULTRA CLEAN */}
                    {!isGameOver && (
                        <div className={`w-full max-w-[340px] p-3 rounded-[2.5rem] shadow-2xl border-b-8 transition-all ${darkMode ? 'bg-slate-900 border-slate-950' : 'bg-white border-slate-200'}`}>
                            <div className="grid grid-cols-7 gap-1.5 mb-2">
                                {bank.map((item, i) => (
                                    <button
                                        key={item.id}
                                        disabled={item.used}
                                        onClick={() => handleBankClick(i)}
                                        className={`
                                            aspect-square flex items-center justify-center rounded-xl font-black text-xl transition-all active:scale-90
                                            ${item.used ? 'scale-0 opacity-0 pointer-events-none' : 
                                                selectedBankIdx === i ? 'bg-indigo-600 text-white ring-4 ring-indigo-500/30 scale-110 z-20' : 
                                                (darkMode ? 'bg-slate-800 text-indigo-400 border-2 border-slate-700 hover:bg-slate-700' : 'bg-indigo-50 text-indigo-700 border-2 border-indigo-100 hover:bg-indigo-100')}
                                        `}
                                    >
                                        {item.char}
                                    </button>
                                ))}
                            </div>

                            <button 
                                onClick={() => { if (isComplete) { setIsGameOver(true); setShowShareModal(true); } }}
                                className={`w-full font-black py-4 rounded-2xl text-lg shadow-lg transition-all active:scale-95 flex items-center justify-center gap-2
                                    ${isComplete ? 'bg-indigo-600 text-white hover:bg-indigo-700 shadow-indigo-600/30' : (darkMode ? 'bg-slate-800 text-slate-700' : 'bg-slate-200 text-slate-400') + ' pointer-events-none'}
                                `}
                            >
                                LOCK & MAIL
                            </button>
                        </div>
                    )}

                    {/* WORLD CLASS SHARE MODAL */}
                    {showShareModal && (
                        <div className="fixed inset-0 bg-slate-950/95 backdrop-blur-xl flex items-center justify-center p-4 z-50 animate-in fade-in duration-300">
                            <div className={`${darkMode ? 'bg-[#0f172a] border border-slate-800' : 'bg-white'} w-full max-w-[340px] rounded-[3rem] overflow-hidden shadow-2xl animate-in zoom-in duration-300`}>
                                <div className="bg-gradient-to-br from-indigo-600 to-indigo-800 p-8 text-white text-center relative overflow-hidden">
                                    <div className="absolute top-0 right-0 p-4 opacity-10 rotate-12"><TrophyIcon /></div>
                                    <TrophyIcon />
                                    <h2 className="text-3xl font-black tracking-tight uppercase italic leading-none mt-4">Trail Solved!</h2>
                                </div>
                                
                                <div className="p-8 space-y-6">
                                    <div className="grid grid-cols-2 gap-4">
                                            <div className={`p-4 rounded-3xl border-2 text-center ${darkMode ? 'border-slate-800 bg-slate-900/50' : 'border-slate-100 bg-slate-50'}`}>
                                                    <p className="text-[9px] font-black text-slate-500 uppercase tracking-widest">FINAL TIME</p>
                                                    <p className="text-2xl font-black text-orange-500">{formatTime(seconds)}</p>
                                            </div>
                                            <div className={`p-4 rounded-3xl border-2 text-center ${darkMode ? 'border-slate-800 bg-slate-900/50' : 'border-slate-100 bg-slate-50'}`}>
                                                    <p className="text-[9px] font-black text-slate-500 uppercase tracking-widest">CHECKS</p>
                                                    <p className="text-2xl font-black text-orange-500">{checkCount}</p>
                                            </div>
                                    </div>

                                    <textarea 
                                        placeholder="Type a personal message..."
                                        value={personalMessage}
                                        onChange={(e) => setPersonalMessage(e.target.value)}
                                        className={`w-full p-4 border-2 rounded-2xl font-bold outline-none h-24 resize-none text-sm shadow-inner transition-colors ${darkMode ? 'bg-slate-950 border-slate-800 text-white focus:border-indigo-500' : 'bg-slate-50 border-slate-100 text-slate-900 focus:border-indigo-500'}`}
                                    />

                                    <div className={`flex justify-between p-2 rounded-2xl border ${darkMode ? 'bg-slate-950 border-slate-800' : 'bg-indigo-50 border-indigo-100'}`}>
                                        {["ðŸ‘‹", "ðŸ”¥", "ðŸ¤”", "ðŸ’ª", "ðŸ†"].map(e => (
                                            <button key={e} onClick={() => setSelectedEmoji(e)} className={`text-2xl p-2 rounded-xl transition-all ${selectedEmoji === e ? (darkMode ? 'bg-slate-800 shadow-md' : 'bg-white shadow-md') + ' scale-125' : 'opacity-30 hover:opacity-100'}`}>{e}</button>
                                        ))}
                                    </div>

                                    <button id="share-btn" onClick={copyToClipboard} className="w-full bg-indigo-600 text-white font-black py-5 rounded-[1.8rem] shadow-xl flex items-center justify-center gap-2 active:scale-95 transition-all shadow-indigo-600/30">
                                        SHARE YOUR RESULTS
                                    </button>
                                    <button onClick={() => setShowShareModal(false)} className="w-full text-slate-500 font-bold py-2 text-xs uppercase tracking-[0.2em] text-center">Back to Grid</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
